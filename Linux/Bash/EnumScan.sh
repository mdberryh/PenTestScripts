#!/bin/bash
echo "enum scanning"

nmap -p 80 10.11.1.1-255 --open |grep "report" |cut -d" " -f5 > port80Machines.txt
for ipAddr in $(cat port80Machines.txt); do
	mkdir -p hosts/"$ipAddr"
	#nmap -sV --script=http-enum* "$ipAddr" > hosts/"$ipAddr"/nmapNSEP80.txt
	nikto -h "$ipAddr" -port 80 > hosts/"$ipAddr"/niktoP80.txt&
#	dirb http://"$ipAddr"/ > hosts/"$ipAddr"/dirb.txt&
done

nmap -p 443 10.11.1.1-255 --open |grep "report" |cut -d" " -f5 > port443Machines.txt
for ipAddr in $(cat port443Machines.txt); do
	mkdir -p hosts/"$ipAddr"
	#nmap -sV --script=http-enum* "$ipAddr" > hosts/"$ipAddr"/nmapNSEP443.txt
	nikto -h "$ipAddr" -port 443 > hosts/"$ipAddr"/niktoP443.txt&
#	dirb https://"$ipAddr"/ | grep -v "--> Testing:" > hosts/"$ipAddr"/dirb.txt&
done
	

#scan for all hosts with port 139,445 open and hit it with enum4linux...and nmap smb nse scripts.

nmap -p 139,445 10.11.1.1-255 --open |grep "report" |cut -d" " -f5 > port139Machines.txt
for ipAddr in $(cat port139Machines.txt); do
	mkdir -p hosts/"$ipAddr"
	#nmap -sV --script=smb-enum* "$ipAddr" > hosts/"$ipAddr"/nmapNSESMB.txt
	enum4linux "$ipAddr" > hosts/"$ipAddr"/enum4linux.txt
	nbtscan "$ipAddr" > hosts/"$ipAddr"/nbtscan.txt
	
done

#a big one liner for smb vulns
for ipAddr in $(cat port139Machines.txt); do nmap -v -p 139,445 --script=smb-vuln* --script-args=unsafe=1 "$ipAddr" > hosts/"$ipAddr"/nmapSmbVulns.txt; done;

