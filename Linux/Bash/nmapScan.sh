#!/bin/bash
echo "scanning machines"
nmap -sP 10.11.1.1-255 | grep "report" | cut -d" " -f5 > pingedHosts.txt

echo "Creating directory for host ip addresses"
#create a directory called hosts if it doesn't exist…
mkdir -p hosts/

echo "Looping through all possible ip addresses."
#loop through entire ip range searching for ip addresses.
#first search was with a quick ping now if not in quick ping scan all ports.
for ip in $(seq 1 255); do
	ipAddr=10.11.1."$ip"
	#check file if we have the host ip recorded…don't fully scan right now.
	if grep -Fxq "$ipAddr" pingedHosts.txt
	then
		#FOUND MATCH create the directory for the ip addr and ad to hosts.txt
		echo "$ipAddr" >> identifiedHosts.txt
	else
		# NOT FOUND scan more indepth with nmap
	upIp=$(nmap -Pn $ipAddr | grep "report for" | cut -d" " -f5)
	upIp=$(echo -e "$upIp"|tr -d '[:space:]')
		if [ ! -z "$upIp"]; then
		    echo "$upIp"
			echo "$upIp" >> identifiedHosts.txt
		fi
	fi
done
remove temp file.
rm pingedHosts.txt

#create directories for hosts
for ip in $(cat ./identifiedHosts.txt); do
  mkdir -p hosts/"$ip"
  #scan with more intensive nmap in the back ground...
  nmap -v -A "$ip" |grep "open" | grep -v "Not Shown" |grep -v "Warning" |grep -v "Discovered" > hosts/"$ip"/NmapOpenPorts.txt&
  
  #if http or https then scan with nikto and dirb in the background
  
  #if smb then scan with smb4linux
  
done


